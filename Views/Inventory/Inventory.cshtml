@{
    ViewData["Title"] = "inventory";
    Layout = "_Layout";
}
<!-- Wrapper -->

<!-- Wrapper -->

<!-- Navbar -->

<!-- /.navbar -->

<!-- Main Sidebar Container -->

<!-- Main Sidebar Container -->

<!--Content Header -->
<section class="content-header">
    <div class="container-fluid">
        <div class="row mb-2">
            <div class="col-sm-6">
                <h1>Inventory</h1>
            </div>
            <div class="col-sm-6">
                <ol class="breadcrumb float-sm-right">
                    <li class="breadcrumb-item"><a asp-controller="Home" asp-action="Index">Home</a></li>
                    <li class="breadcrumb-item active">Quotation</li>
                </ol>
            </div>
        </div>
    </div>
</section>
<!--Content Header -->

<!-- Main content -->
<section class="content">
<!-- Listing table -->
<div class="card">
    <div class="card-header">
        <h3 class="card-title">Inventory List</h3>
    </div>
@model IEnumerable<AutocountCRM_ProjectOne.Models.Inventory>

<div class="card-body p-0">
  <table class="table table-striped projects">
    <thead>
      <tr>
        <th style="width: 5%">#</th>
        <th style="width: 20%">Item Code</th>
        <th style="width: 25%">Description</th>
        <th style="width: 10%">Total Qty</th>
        <th style="width: 10%">Item Group</th>
        <th style="width: 10%" class="text-center">Price (RM)</th>
        <th style="width: 20%"></th>
      </tr>
    </thead>
    <tbody>
      @if (Model != null && Model.Any())
      {
        int counter = 1;
        foreach (var item in Model)
        {
          <tr data-item='@System.Text.Json.JsonSerializer.Serialize(item)'data-id="@item.ItemID">
            <td>@counter</td>
            <td><a>@(item.ItemCode ?? "N/A")</a></td>
            <td>@(item.Description ?? "No description")</td>
            <td>@(item.TotalQty ?? 0)</td>
            <td>@(item.ItemGroup ?? "-")</td>
            <td class="text-center">@((item.Price1 ?? 0).ToString("F2"))</td>
            <td class="project-actions text-right">
              <a href="@Url.Action("EditInventory", new { InventoryId = item.ItemID })" 
                class="btn btn-info btn-sm" target="_blank">
                <i class="fas fa-pencil-alt"></i> Edit
              </a>
              <button type="button" class="btn btn-danger btn-sm delete-inventory-btn" data-id="@item.ItemID"><i class="fas fa-trash"></i>Delete</button>
            </td>
          </tr>
          counter++;
        }
      }
      else
      {
        <tr>
          <td colspan="7" class="text-center">No inventory items found.</td>
        </tr>
      }
    </tbody>
  </table>
</div>

</div>


      <!-- Listing table -->

      <!-- Inventory Detail Card -->

</section>

<!-- Initialize Select2 -->

  <!-- /.content-wrapper -->

<!-- Footer -->

<!-- Footer -->

<!-- Control Sidebar -->

<!-- Control Sidebar -->

<!-- wrapper -->

<!-- ./wrapper -->
@section Scripts {
<script>
  document.addEventListener('DOMContentLoaded', () => {
    // get current page path (relative)
    const currentPath = window.location.pathname.split("/").pop();

    // select all sidebar links
    const sidebarLinks = document.querySelectorAll('.nav-sidebar a.nav-link');

    sidebarLinks.forEach(link => {
      // remove any existing active class
      link.classList.remove('active');

      // get href of link
      const linkPath = link.getAttribute('href').split("/").pop();

      // if href matches current page, add active
      if (linkPath === currentPath) {
        link.classList.add('active');

        // expand parent treeview if inside a submenu
        let parent = link.closest('.nav-treeview');
        while (parent) {
          const parentLink = parent.previousElementSibling;
          if (parentLink && parentLink.classList.contains('nav-link')) {
            parentLink.classList.add('active');
          }
          parent = parent.parentElement.closest('.nav-treeview');
        }
      }
    });
  });




  document.querySelectorAll('.delete-inventory-btn').forEach(btn => {
    btn.addEventListener('click', async function(e) {
        e.preventDefault();
        if (!confirm("Are you sure you want to delete this inventory?")) return;

        const id = btn.dataset.id;
        const response = await fetch(`/Inventory/DeleteInventory?ItemID=${id}`, {
            method: 'POST',
            headers: { 'X-Requested-With': 'XMLHttpRequest' }
        });

        const result = await response.json();
        if (result.success) {
            alert("Inventory deleted!");
            window.location.reload(); // refresh page
        } else {
            alert(result.message || 'Error deleting Inventory');
        }
    });
});
</script>
}
