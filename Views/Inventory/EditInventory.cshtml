@model AutocountCRM_ProjectOne.Models.Inventory

@{
    ViewData["Title"] = "Edit Inventory";
}

<section class="content-header">
    <div class="container-fluid">
        <div class="row mb-2">
            <div class="col-sm-6">
                <h1>Edit Inventory</h1>
            </div>
        </div>
    </div>
</section>
<section class="content">
<div class="card card-success">
  <div class="card-header">
    <h3 class="card-title">Edit Inventory Information</h3>
  </div>

<form id="editInventoryForm" class="form-horizontal" method="post" 
      asp-controller="Inventory" 
      asp-action="EditInventory" 
      asp-route-InventoryId="@Model.ItemID">

    @Html.AntiForgeryToken()
    <input type="hidden" asp-for="ItemID" />
    
    <div class="card-body">
      <!-- Item -->
      <div class="form-group row">
        <label class="col-sm-2 col-form-label">Item Code</label>
        <div class="col-sm-4">
          <input type="text" class="form-control" asp-for="ItemCode" placeholder="E.g. ITM001">
        </div>

        <label class="col-sm-2 col-form-label">Description</label>
        <div class="col-sm-4">
          <textarea class="form-control" asp-for="Description" rows="3" placeholder="Product Description" spellcheck="false" data-gramm="false"></textarea>
        </div>
      </div>

      <div class="form-group row">
        <label class="col-sm-2 col-form-label">Total Balance Quantity</label>
        <div class="col-sm-4">
          <input type="number" class="form-control" asp-for="TotalQty" placeholder="0">
        </div>

        <label class="col-sm-2 col-form-label">UOM</label>
        <div class="col-sm-4">
          <input type="text" class="form-control" asp-for="UOM" placeholder="Unit of Measure">
        </div>
      </div>

      <!-- Analysis Code -->
      <div class="form-group row">
        <label class="col-sm-2 col-form-label">Item Group</label>
        <div class="col-sm-4">
          <select class="form-control" asp-for="ItemGroup">
            <option value="">Select Group</option>
            <option>Electronics</option>
            <option>Apparel</option>
            <option>Hardware</option>
            <option>Furniture</option>
            <option>Accessories</option>
          </select>
        </div>

        <label class="col-sm-2 col-form-label">Item Type</label>
        <div class="col-sm-4">
          <select class="form-control" asp-for="ItemType">
            <option value="">Select Type</option>
            <option>Hardware</option>
            <option>Office</option>
            <option>Peripheral</option>
            <option>Accessory</option>
          </select>
        </div>
      </div>

      <!-- Status Checkboxes -->
      <div class="form-group row">
        <label class="col-sm-2 col-form-label">Status</label>
        <div class="col-sm-10">
          <div class="form-check form-check-inline">
            <input class="form-check-input" type="checkbox" asp-for="Active">
            <label class="form-check-label" for="Active">Active</label>
          </div>
          <div class="form-check form-check-inline">
            <input class="form-check-input" type="checkbox" asp-for="HasPromoter">
            <label class="form-check-label" for="HasPromoter">Has Promoter</label>
          </div>
          <div class="form-check form-check-inline">
            <input class="form-check-input" type="checkbox" asp-for="Discontinued">
            <label class="form-check-label" for="Discontinued">Discontinued</label>
          </div>
        </div>
      </div>

      <!-- Costing & Supplier -->
      <div class="form-group row">
        <label class="col-sm-2 col-form-label">Costing Method</label>
        <div class="col-sm-4">
          <input type="text" class="form-control" asp-for="CostingMethod" placeholder="E.g. FIFO, LIFO">
        </div>

        <label class="col-sm-2 col-form-label">Main Supplier</label>
        <div class="col-sm-4">
          <input type="text" class="form-control" asp-for="MainSupplier" placeholder="Supplier Name">
        </div>
      </div>

      <!-- Inventory Lead & Duty -->
      <div class="form-group row">
        <label class="col-sm-2 col-form-label">Inventory Time</label>
        <div class="col-sm-4">
          <input type="text" class="form-control" asp-for="LeadTime" placeholder="E.g. 7 days">
        </div>

        <label class="col-sm-2 col-form-label">Duty Rate</label>
        <div class="col-sm-4">
          <input type="text" class="form-control" asp-for="DutyRate" placeholder="E.g. 10%">
        </div>
      </div>

      <!-- Tax Codes -->
      <div class="form-group row">
        <label class="col-sm-2 col-form-label">Supply Tax Code</label>
        <div class="col-sm-4">
          <input type="text" class="form-control" asp-for="SupplyTaxCode" placeholder="Tax Code">
        </div>

        <label class="col-sm-2 col-form-label">Purchase Tax Code</label>
        <div class="col-sm-4">
          <input type="text" class="form-control" asp-for="PurchaseTaxCode" placeholder="Tax Code">
        </div>
      </div>

      <!-- Tariff & Margin -->
      <div class="form-group row">
        <label class="col-sm-2 col-form-label">Tariff Code</label>
        <div class="col-sm-4">
          <input type="text" class="form-control" asp-for="TariffCode" placeholder="Tariff Code">
        </div>

        <label class="col-sm-2 col-form-label">Margin</label>
        <div class="col-sm-4">
          <input type="text" class="form-control" asp-for="Margin" placeholder="E.g. 20%">
        </div>
      </div>

      <!-- Standard Cost -->
      <div class="form-group row">
        <label class="col-sm-2 col-form-label">Standard Cost</label>
        <div class="col-sm-4">
          <input type="number" class="form-control" asp-for="StandardCost" placeholder="RM 0.00" step="0.01">
        </div>
      </div>

      <!-- Purchase Prices -->
      <div class="form-group row">
        <label class="col-sm-2 col-form-label">Min Purchase Price</label>
        <div class="col-sm-4">
          <input type="number" class="form-control" asp-for="MinPurchasePrice" placeholder="RM 0.00" step="0.01">
        </div>

        <label class="col-sm-2 col-form-label">Max Purchase Price</label>
        <div class="col-sm-4">
          <input type="number" class="form-control" asp-for="MaxPurchasePrice" placeholder="RM 0.00" step="0.01">
        </div>
      </div>

      <!-- Selling Price -->
      <div class="form-group row">
        <label class="col-sm-2 col-form-label">Selling Price (1 - 6)</label>
        <div class="col-sm-10">
          <div class="row">
            <div class="col-sm-2 mb-2">
              <input type="number" class="form-control" asp-for="Price1" placeholder="Price 1" step="0.01">
            </div>
            <div class="col-sm-2 mb-2">
              <input type="number" class="form-control" asp-for="Price2" placeholder="Price 2" step="0.01">
            </div>
            <div class="col-sm-2 mb-2">
              <input type="number" class="form-control" asp-for="Price3" placeholder="Price 3" step="0.01">
            </div>
            <div class="col-sm-2 mb-2">
              <input type="number" class="form-control" asp-for="Price4" placeholder="Price 4" step="0.01">
            </div>
            <div class="col-sm-2 mb-2">
              <input type="number" class="form-control" asp-for="Price5" placeholder="Price 5" step="0.01">
            </div>
            <div class="col-sm-2 mb-2">
              <input type="number" class="form-control" asp-for="Price6" placeholder="Price 6" step="0.01">
            </div>
          </div>
        </div>
      </div>

      <!-- Min/Max Selling Prices -->
      <div class="form-group row">
        <label class="col-sm-2 col-form-label">Min Selling Price</label>
        <div class="col-sm-4">
          <input type="number" class="form-control" asp-for="MinSellingPrice" placeholder="RM 0.00" step="0.01">
        </div>

        <label class="col-sm-2 col-form-label">Max Selling Price</label>
        <div class="col-sm-4">
          <input type="number" class="form-control" asp-for="MaxSellingPrice" placeholder="RM 0.00" step="0.01">
        </div>
      </div>
    </div>

    <!-- Footer Buttons -->
    <div class="card-footer d-flex justify-content-between">
      <div>
        <button type="submit" class="btn btn-info">Save Changes</button>
        <a class="btn btn-secondary" asp-controller="Inventory" asp-action="Index">Cancel</a>
        <button type="button" class="btn btn-danger delete-inventory-btn" data-id="@Model.ItemID">Delete Item</button>
      </div>
    </div>
  </form>
</div>
</section>

@section Scripts {
<script>
document.getElementById('editInventoryForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    const form = e.target;
    const data = new FormData(form);

    const response = await fetch(form.action, {
        method: 'POST',
        body: data,
        headers: { 'X-Requested-With': 'XMLHttpRequest' }
    });

    const result = await response.json();
    if (result.success) {
        alert("Changes saved!");
        window.close(); // close tab after user clicks OK
    } else {
        alert(result.message || 'Error saving Inventory');
    }
});

document.querySelectorAll('.delete-inventory-btn').forEach(btn => {
    btn.addEventListener('click', async function(e) {
        e.preventDefault();
        if (!confirm("Are you sure you want to delete this Inventory?")) return;

        const id = btn.dataset.id;
        const response = await fetch(`/Inventory/DeleteInventory?ItemID=${id}`, {
            method: 'POST',
            headers: { 'X-Requested-With': 'XMLHttpRequest' }
        });

        const result = await response.json();
        if (result.success) {
            alert("inventory deleted!");
            window.close();
        } else {
            alert(result.message || 'Error deleting inventory');
        }
    });
});
</script>
}