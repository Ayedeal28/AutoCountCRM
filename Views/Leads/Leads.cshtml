@{
    ViewData["Title"] = "Leads";
    Layout = "_Layout";
}
  <!-- Wrapper -->
  
  <!-- Wrapper -->

  <!-- Navbar -->

  <!-- /.navbar -->

  <!-- Main Sidebar Container -->

  <!-- Main Sidebar Container -->

    <!-- Content Header (Page header) -->
    <section class="content-header">
      <div class="container-fluid">
        <div class="row mb-2">
          <div class="col-sm-6">
            <h1>Leads</h1>
          </div>
          <div class="col-sm-6">
            <ol class="breadcrumb float-sm-right">
              <li class="breadcrumb-item"><a asp-controller="Leads" asp-action="Home">Home</a></li>
              <li class="breadcrumb-item active">Manage Leads</li>
            </ol>
          </div>
        </div>
      </div>  
    </section>

    <!-- Main content -->
<section class="content">
@model IEnumerable<AutocountCRM_ProjectOne.Models.leads_list>

<div class="card">
    <div class="card-header">
        <h3 class="card-title">Leads</h3>
        <div class="card-tools">
            <a class="btn btn-primary" asp-controller="Leads" asp-action="AddLead" target="_blank">Add Lead</a>
        </div>
    </div>
    <div class="card-body p-0">
        <table class="table table-striped projects">
            <thead>
                <tr>
                    <th style="width: 1%">#</th>
                    <th style="width: 20%">Lead Name</th>
                    <th style="width: 30%">Company</th>
                    <th>Assigned S.A</th>
                    <th style="width: 8%" class="text-center">Status</th>
                    <th style="width: 20%"></th>
                </tr>
            </thead>
              <tbody>
                @{ int counter = 1; }
                  @foreach (var lead in Model)
                  {
                      var badgeClass = lead.LeadStatus?.ToLower() switch
                      {
                          "new" => "badge badge-success",
                          "contacted" => "badge badge-info",
                          "qualified" => "badge badge-warning",
                          "lost" => "badge badge-danger",
                          _ => "badge badge-secondary"
                      };

                      <tr data-id="@lead.Id">
                          <td>@counter</td>
                          <td>
                              <a>@($"{lead.FirstName} {lead.LastName}")</a><br>
                              <small>Created on :@lead.CreatedAt?.ToString("dd.MM.yyyy")</small>
                          </td>
                          <td>@lead.Company</td>
                          <td>@lead.AssignedTo</td>
                          <td class="project-state">
                              <span class="@badgeClass">@lead.LeadStatus</span>
                          </td>
                          <td class="project-actions text-right">
                              <a href="@Url.Action("EditLeads", new { leadsId = lead.Id })" 
                                class="btn btn-info btn-sm" target="_blank">
                                  <i class="fas fa-pencil-alt"></i> Edit/View
                              </a>
                              <button type="button" class="btn btn-danger btn-sm delete-lead-btn" data-id="@lead.Id"><i class="fas fa-trash"></i>Delete</button>

                          </td>
                      </tr>
                      counter++;
                  }
              </tbody>


      </table>
    </div>
    <!-- /.card-body -->
  </div>
</section>
  <!-- /.content-wrapper -->
  <!-- Control Sidebar -->

  <!-- Footer -->

  <!-- Footer -->

  <!-- Control Sidebar -->

  <!-- Control Sidebar -->

  <!-- /.control-sidebar -->

  <!-- ./wrapper -->

  <!-- ./wrapper -->
@section Scripts {
<script>
  document.addEventListener('DOMContentLoaded', () => {
    // get current page path (relative)
    const currentPath = window.location.pathname.split("/").pop();

    // select all sidebar links
    const sidebarLinks = document.querySelectorAll('.nav-sidebar a.nav-link');

    sidebarLinks.forEach(link => {
      // remove any existing active class
      link.classList.remove('active');

      // get href of link
      const linkPath = link.getAttribute('href').split("/").pop();

      // if href matches current page, add active
      if (linkPath === currentPath) {
        link.classList.add('active');

        // expand parent treeview if inside a submenu
        let parent = link.closest('.nav-treeview');
        while (parent) {
          const parentLink = parent.previousElementSibling;
          if (parentLink && parentLink.classList.contains('nav-link')) {
            parentLink.classList.add('active');
          }
          parent = parent.parentElement.closest('.nav-treeview');
        }
      }
    });
  });




  document.querySelectorAll('.delete-lead-btn').forEach(btn => {
    btn.addEventListener('click', async function(e) {
        e.preventDefault();
        if (!confirm("Are you sure you want to delete this lead?")) return;

        const id = btn.dataset.id;
        const response = await fetch(`/Leads/DeleteLead?id=${id}`, {
            method: 'POST',
            headers: { 'X-Requested-With': 'XMLHttpRequest' }
        });

        const result = await response.json();
        if (result.success) {
            alert("Lead deleted!");
            window.location.reload(); // refresh page
        } else {
            alert(result.message || 'Error deleting lead');
        }
    });
});
</script>
}